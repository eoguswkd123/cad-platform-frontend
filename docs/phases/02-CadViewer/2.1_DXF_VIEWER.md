# Phase 2.1: DXF CAD Viewer Implementation

> **Version**: 0.0.8
> **Last Updated**: 2025-12-30
> **Status**: ğŸ”„ ì§„í–‰ ì¤‘ (75%)

---

## Table of Contents (ëª©ì°¨)

- [1. Overview (ê°œìš”)](#1-overview-ê°œìš”)
- [2. Architecture (ì•„í‚¤í…ì²˜)](#2-architecture-ì•„í‚¤í…ì²˜)
- [3. Implementation Checklist (êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸)](#3-implementation-checklist-êµ¬í˜„-ì²´í¬ë¦¬ìŠ¤íŠ¸)
- [4. Key Implementation Details (í•µì‹¬ êµ¬í˜„ ìƒì„¸)](#4-key-implementation-details-í•µì‹¬-êµ¬í˜„-ìƒì„¸)
- [5. Testing Strategy (í…ŒìŠ¤íŠ¸ ì „ëµ)](#5-testing-strategy-í…ŒìŠ¤íŠ¸-ì „ëµ)
- [6. Routes & Navigation (ë¼ìš°íŠ¸ ë° ë„¤ë¹„ê²Œì´ì…˜)](#6-routes--navigation-ë¼ìš°íŠ¸-ë°-ë„¤ë¹„ê²Œì´ì…˜)
- [7. Dependencies & References (ì˜ì¡´ì„± ë° ì°¸ì¡°)](#7-dependencies--references-ì˜ì¡´ì„±-ë°-ì°¸ì¡°)
- [8. Usage Guide (ì‚¬ìš© ê°€ì´ë“œ)](#8-usage-guide-ì‚¬ìš©-ê°€ì´ë“œ)
- [9. Post-Completion Checklist (ì™„ë£Œ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸)](#9-post-completion-checklist-ì™„ë£Œ-í›„-ì²´í¬ë¦¬ìŠ¤íŠ¸)
- [10. Changelog (ë³€ê²½ ì´ë ¥)](#10-changelog-ë³€ê²½-ì´ë ¥)

---

## ğŸ¤– Claude Commands

### ì´ ë¬¸ì„œ ì‘ì„± ì‹œ (í…œí”Œë¦¿ ê¸°ë°˜ ë¬¸ì„œ ìƒì„±)

```bash
/sc:design [phase-feature-name] --template @docs/phases/templates/PHASE_DEV_TEMPLATE.md [--think|--think-hard|--ultrathink]

# ì˜ˆì‹œ
/sc:design phase-2a3-hatch-entity --template @docs/phases/templates/PHASE_DEV_TEMPLATE.md --think-hard
```

### ìƒì„±ëœ ë¬¸ì„œ ê²€ì¦ ì‹œ (í’ˆì§ˆ ê²€ì¦)

```bash
/sc:spec-panel @docs/phases/[Phaseí´ë”]/[ìƒì„±ëœíŒŒì¼].md

# ì˜ˆì‹œ
/sc:spec-panel @docs/phases/02-CadViewer/2.1_DXF_VIEWER.md
```

### ê²€ì¦ëœ ë¬¸ì„œ ê¸°ë°˜ êµ¬í˜„ ì‹œ

```bash
/sc:implement @docs/phases/[Phaseí´ë”]/[THIS_FILE].md --validate

# ì˜ˆì‹œ
/sc:implement @docs/phases/02-CadViewer/2.1_DXF_VIEWER.md --validate
```

### ê°œë°œ ì™„ë£Œ í›„

êµ¬í˜„ì´ ì™„ë£Œë˜ë©´ Claudeê°€ ìë™ìœ¼ë¡œ ì—°ê´€ ë¬¸ì„œ ì—…ë°ì´íŠ¸ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤:

- ì–´ë–¤ ë‚´ìš©ì´ ë³€ê²½ë˜ëŠ”ì§€ ë¯¸ë¦¬ ë³´ì—¬ì¤Œ
- ìŠ¹ì¸ í›„ ROADMAP, ARCHITECTURE, README ì—…ë°ì´íŠ¸

---

## Phase Progress (ì§„í–‰ ìƒí™©)

| Sub-Phase | ìƒíƒœ | ì„¤ëª…                                                  |
| --------- | ---- | ----------------------------------------------------- |
| 2.1.1     | âœ…   | MVP - LINE ì—”í‹°í‹°, íŒŒì¼ ì—…ë¡œë“œ, ê¸°ë³¸ ë Œë”ë§           |
| 2.1.2     | âœ…   | CIRCLE, ARC, POLYLINE ì—”í‹°í‹° í™•ì¥                     |
| 2.1.3     | âœ…   | HATCH (2D) ì—”í‹°í‹° + ë Œë”ë§ ëª¨ë“œ í† ê¸€                  |
| 2.1.4     | âœ…   | ì¶”ê°€ ì—”í‹°í‹° (TEXT, MTEXT, DIMENSION, SPLINE, ELLIPSE) |
| 2.1.5     | âœ…   | ë ˆì´ì–´ë³„ ìƒ‰ìƒ/ê°€ì‹œì„± í† ê¸€                             |
| 2.1.6     | â³   | HATCH 3D Extrusion (2D HATCH â†’ ExtrudeGeometry)       |
| 2.1.7     | â³   | ShadingMode ì ìš© (3D ë©”ì‰¬ Material 4ê°€ì§€ ëª¨ë“œ)        |
| 2.1.8     | ğŸ”„   | ì„±ëŠ¥ ìµœì í™” (2D/3D Geometry ë¨¸ì§•, WebWorker, LOD)     |
| 2.1.9     | ğŸ”„   | Unit í…ŒìŠ¤íŠ¸ (3D í¬í•¨ í™•ì¥)                            |

---

## 1. Overview (ê°œìš”)

### 1.1 ëª©í‘œ

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ DXF íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ 3D ì™€ì´ì–´í”„ë ˆì„ìœ¼ë¡œ ë Œë”ë§ (ë°±ì—”ë“œ ë¶ˆí•„ìš”)

### 1.2 MVP ë²”ìœ„

| í•­ëª©          | MVP ë²”ìœ„              | í™•ì¥ ë‹¨ê³„                                |
| ------------- | --------------------- | ---------------------------------------- |
| **íŒŒì¼ í˜•ì‹** | DXF (ASCII)           | DWG, PDF (Phase 2.2)                     |
| **ì—”í‹°í‹°**    | LINE                  | ARC, CIRCLE, POLYLINE âœ…                 |
| **HATCH**     | -                     | 2D ë©´ ì±„ìš°ê¸° âœ…, 3D ëŒì¶œ â³              |
| **ë ˆì´ì–´**    | ë‹¨ì¼ ë ˆì´ì–´           | ë ˆì´ì–´ë³„ ìƒ‰ìƒ/ê°€ì‹œì„± âœ…                  |
| **UI**        | íŒŒì¼ ì—…ë¡œë“œ + 3D ë·°ì–´ | ë ˆì´ì–´ íŒ¨ë„ âœ…, ë Œë”ë§ í† ê¸€ âœ…           |
| **3D ë Œë”ë§** | -                     | HATCH 3D â³, ShadingMode (4ê°€ì§€ ëª¨ë“œ) â³ |
| **ì„±ëŠ¥**      | ê¸°ë³¸                  | 2D WebWorker/LOD âœ…, 3D ìµœì í™” ğŸ”„        |

### 1.3 ê¸°ìˆ ì  ì œì•½

- DXF ASCII í˜•ì‹ë§Œ ì§€ì› (ë°”ì´ë„ˆë¦¬ DXF ë¯¸ì§€ì›)
- íŒŒì¼ í¬ê¸° ì œí•œ: 20MB
- WebWorker ì‚¬ìš© ì¡°ê±´: íŒŒì¼ > 2MB

---

## 2. Architecture (ì•„í‚¤í…ì²˜)

### 2.1 ë””ë ‰í† ë¦¬ êµ¬ì¡°

> **Note**: v0.0.8ì—ì„œ ì½”ë“œ ì¬ì‚¬ìš©ì„±ì„ ìœ„í•´ ê³µìœ  ì»´í¬ë„ŒíŠ¸/íƒ€ì…/ìœ í‹¸ë¦¬í‹°ê°€ `src/` ìµœìƒìœ„ë¡œ ë¦¬íŒ©í† ë§ë¨

```
src/features/CadViewer/           # Feature ëª¨ë“ˆ (DXF ì „ìš© ë¡œì§)
â”œâ”€â”€ index.ts                      # Public exports (CadScene)
â”œâ”€â”€ constants.ts                  # ì„¤ì • ìƒìˆ˜ (FILE_LIMITS, CONFIG ë“±)
â”œâ”€â”€ FLOWCHART.md                  # ë°ì´í„° íë¦„ ë¬¸ì„œ
â”œâ”€â”€ types/                        # DXF ì „ìš© íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ index.ts                  # í†µí•© export (re-export from @/types/cad)
â”‚   â”œâ”€â”€ dxfEntity/                # DXF ì—”í‹°í‹° íƒ€ì…
â”‚   â”‚   â”œâ”€â”€ base.ts               # DXF ì „ìš© ê¸°ë³¸ íƒ€ì…
â”‚   â”‚   â”œâ”€â”€ library.ts            # dxf-parser ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶œë ¥ íƒ€ì…
â”‚   â”‚   â”œâ”€â”€ parsed.ts             # re-export (â†’ @/types/cad/entity)
â”‚   â”‚   â””â”€â”€ index.ts              # barrel export
â”‚   â””â”€â”€ dxfWorkerMsg/             # Worker ë©”ì‹œì§€ íƒ€ì…
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â”œâ”€â”€ CadScene.tsx              # ë©”ì¸ 3D ì”¬ ì»¨í…Œì´ë„ˆ (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°)
â”‚   â””â”€â”€ LayerPanel.tsx            # ë ˆì´ì–´ íŒ¨ë„ UI
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â”œâ”€â”€ useDxfParser.ts           # DXF íŒŒì‹± í›…
â”‚   â”œâ”€â”€ useDxfWorker.ts           # WebWorker íŒŒì‹± í›…
â”‚   â”œâ”€â”€ useDxfLoader.ts           # DXF íŒŒì¼ ë¡œë”© í›… (íŒŒì¼/URL í†µí•©)
â”‚   â”œâ”€â”€ useCadMaterial.ts         # â³ ShadingMode Material í›… (2.1.7)
â”‚   â””â”€â”€ __tests__/                # í›… í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ useDxfParser.test.ts
â”‚       â”œâ”€â”€ useDxfWorker.test.ts
â”‚       â””â”€â”€ useDxfLoader.test.ts
â”œâ”€â”€ services/                     # WebWorker ë° íŒŒì‹± ë¡œì§
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â”œâ”€â”€ dxfParser.worker.ts       # DXF íŒŒì‹± WebWorker
â”‚   â”œâ”€â”€ entityParsers.ts          # ì—”í‹°í‹°ë³„ íŒŒì‹± ë¡œì§
â”‚   â”œâ”€â”€ entityMath.ts             # ê¸°í•˜í•™ ê³„ì‚° ìœ í‹¸
â”‚   â””â”€â”€ __tests__/                # ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ dxfParser.worker.test.ts
â”‚       â”œâ”€â”€ entityParsers.test.ts
â”‚       â””â”€â”€ entityMath.test.ts
â””â”€â”€ utils/
    â”œâ”€â”€ index.ts                  # barrel export (re-export from @/utils/cad)
    â”œâ”€â”€ dxfSamples.ts             # ìƒ˜í”Œ DXF ë°ì´í„°
    â””â”€â”€ __tests__/
        â””â”€â”€ dxfToGeometry.test.ts # ì§€ì˜¤ë©”íŠ¸ë¦¬ ë³€í™˜ í…ŒìŠ¤íŠ¸

src/components/                   # ê³µìœ  ì»´í¬ë„ŒíŠ¸ (cross-feature ì¬ì‚¬ìš©)
â”œâ”€â”€ CadMesh/                      # âœ¨ CAD ë©”ì‰¬ ë Œë”ëŸ¬ (ë¦¬íŒ©í† ë§ë¨)
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â”œâ”€â”€ types.ts                  # CadMesh íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ WireframeMesh.tsx         # ì™€ì´ì–´í”„ë ˆì„ ë Œë”ëŸ¬ (LINE/CIRCLE/ARC ë“±)
â”‚   â”œâ”€â”€ HatchMesh.tsx             # HATCH ë©´ ë Œë”ëŸ¬
â”‚   â”œâ”€â”€ TextMesh.tsx              # TEXT/MTEXT ë Œë”ëŸ¬
â”‚   â”œâ”€â”€ CurveMesh.tsx             # ELLIPSE/SPLINE ë Œë”ëŸ¬
â”‚   â””â”€â”€ DimensionMesh.tsx         # DIMENSION ë Œë”ëŸ¬
â”œâ”€â”€ CadMeshViewer/                # âœ¨ 3D ë Œë”ë§ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° (ë¦¬íŒ©í† ë§ë¨)
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â”œâ”€â”€ types.ts                  # Viewer íƒ€ì… ì •ì˜
â”‚   â””â”€â”€ CadMeshViewer.tsx         # ë©”ì‰¬ ë Œë”ë§ í†µí•© ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ Common/DropZone/              # ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­
â”œâ”€â”€ FilePanel/                    # íŒŒì¼ ì—…ë¡œë“œ íŒ¨ë„
â”œâ”€â”€ FilePanelViewer/              # íŒŒì¼ íŒ¨ë„ ì»´í¬ì§€íŠ¸ ë˜í¼
â”œâ”€â”€ ControlPanelViewer/           # ì»¨íŠ¸ë¡¤ íŒ¨ë„ ë˜í¼
â””â”€â”€ SceneCanvasViewer/            # 3D ì”¬ ì»´í¬ì§€íŠ¸ ë˜í¼

src/types/                        # ê³µìœ  íƒ€ì… ì •ì˜
â”œâ”€â”€ cad/                          # âœ¨ CAD ê³µí†µ íƒ€ì… (ë¦¬íŒ©í† ë§ë¨)
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â””â”€â”€ entity.ts                 # ParsedLine, ParsedCircle, ParsedCADData ë“±
â””â”€â”€ dxf-parser.d.ts               # dxf-parser ë¼ì´ë¸ŒëŸ¬ë¦¬ íƒ€ì… ì„ ì–¸

src/utils/                        # ê³µìœ  ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ cad/                          # âœ¨ CAD ê³µí†µ ìœ í‹¸ (ë¦¬íŒ©í† ë§ë¨)
â”‚   â”œâ”€â”€ index.ts                  # barrel export
â”‚   â”œâ”€â”€ dxfToGeometry.ts          # DXF â†’ Three.js ë³€í™˜
â”‚   â”œâ”€â”€ cadDataUtils.ts           # CAD ë°ì´í„° ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ TextureCacheManager.ts    # í…ìŠ¤ì²˜ ìºì‹œ ê´€ë¦¬
â”œâ”€â”€ fileValidator.ts              # íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
â”œâ”€â”€ urlValidator.ts               # URL ìœ íš¨ì„± ê²€ì‚¬
â”œâ”€â”€ errorClassifier.ts            # ì—ëŸ¬ ë¶„ë¥˜
â””â”€â”€ errorFormatter.ts             # ì—ëŸ¬ ë©”ì‹œì§€ í¬ë§·íŒ…

src/pages/CadViewer/
â””â”€â”€ index.tsx                     # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸

public/samples/dxf/               # í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ íŒŒì¼
â”œâ”€â”€ simple-room.dxf
â””â”€â”€ ...

tests/
â”œâ”€â”€ mocks/dxf-parser/             # DXF íŒŒì„œ ëª© (fixtures, config)
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ fixtures.ts               # 23ê°œ í…ŒìŠ¤íŠ¸ fixture
â”‚   â”œâ”€â”€ mock-config.ts
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ mocks/worker.ts               # Worker mock
â”œâ”€â”€ integration/                  # í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ dxf-pipeline.test.ts
â”‚   â””â”€â”€ dxf-security.test.ts
â””â”€â”€ scripts/                      # í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
```

### 2.2 ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ

> **Note**: v0.0.8ì—ì„œ CadMeshê°€ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬ë¨

```
CadViewerPage                          [custom] í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ FilePanelViewer                    [custom / HTML] íŒŒì¼ ì—…ë¡œë“œ ì»´í¬ì§€íŠ¸
â”‚   â”œâ”€â”€ FileUploadBox                  [custom] íŒŒì¼ ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­
â”‚   â”œâ”€â”€ SampleList                     [custom] ì„œë²„ ìƒ˜í”Œ ëª©ë¡
â”‚   â””â”€â”€ UrlInput                       [custom] URL ì…ë ¥
â”œâ”€â”€ CadScene                           [custom] ë©”ì¸ ì”¬ ì»¨í…Œì´ë„ˆ (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°)
â”‚   â””â”€â”€ SceneCanvas                    [custom] 3D ì”¬ ë˜í¼ (React.lazy ë¡œë”©)
â”‚       â””â”€â”€ Canvas                     [@react-three/fiber] 3D ìº”ë²„ìŠ¤
â”‚           â”œâ”€â”€ PerspectiveCamera      [@react-three/drei] ì›ê·¼ ì¹´ë©”ë¼
â”‚           â”œâ”€â”€ OrbitControls          [@react-three/drei] ê¶¤ë„ ì»¨íŠ¸ë¡¤
â”‚           â”œâ”€â”€ ambientLight           [R3F built-in] í™˜ê²½ê´‘
â”‚           â”œâ”€â”€ directionalLight       [R3F built-in] ë°©í–¥ê´‘ (3Dìš©)
â”‚           â”œâ”€â”€ gridHelper             [R3F built-in] ë°”ë‹¥ ê·¸ë¦¬ë“œ
â”‚           â””â”€â”€ CadMeshViewer          [custom] âœ¨ 3D ë Œë”ë§ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
â”‚               â”œâ”€â”€ WireframeMesh      [custom] LINE/CIRCLE/ARC/POLYLINE ë Œë”ëŸ¬
â”‚               â”œâ”€â”€ HatchMesh          [custom] HATCH ë©´ ë Œë”ëŸ¬
â”‚               â”œâ”€â”€ TextMesh           [custom] TEXT/MTEXT ë Œë”ëŸ¬
â”‚               â”œâ”€â”€ CurveMesh          [custom] ELLIPSE/SPLINE ë Œë”ëŸ¬
â”‚               â””â”€â”€ DimensionMesh      [custom] DIMENSION ë Œë”ëŸ¬
â”œâ”€â”€ ControlPanelViewer                 [custom / HTML] ê³µí†µ ì„¤ì • íŒ¨ë„
â”‚   â””â”€â”€ ShadingSelect                  [custom / HTML] â³ ShadingMode ì„ íƒ (2.1.7)
â”œâ”€â”€ RenderModePanel                    [custom / HTML] ë Œë”ë§ ëª¨ë“œ í† ê¸€ (HATCHìš©)
â”œâ”€â”€ DepthControl                       [custom / HTML] â³ 3D ëŒì¶œ ê¹Šì´ ì¡°ì ˆ (2.1.6)
â””â”€â”€ LayerPanel                         [custom / HTML] ë ˆì´ì–´ í† ê¸€
```

**ë²”ë¡€:**

- `[custom]` - ì§ì ‘ êµ¬í˜„í•œ ì»´í¬ë„ŒíŠ¸
- `[@react-three/fiber]` - R3F ì½”ì–´
- `[@react-three/drei]` - R3F í—¬í¼ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `[R3F built-in]` - Three.js ê°ì²´
- `âœ¨` - v0.0.8 ë¦¬íŒ©í† ë§ëœ ì»´í¬ë„ŒíŠ¸

### 2.3 ë°ì´í„° íë¦„

```
File Drop â†’ FilePanelViewer â†’ useDxfLoader â†’ ParsedCADData â†’ CadMeshViewer â†’ Three.js Render
                                    â†“
                              (íŒŒì¼ > 2MB)
                                    â†“
                              useDxfWorker (WebWorker)

ìƒíƒœ íë¦„:
1. File â†’ text() â†’ dxf-parser
2. entities â†’ entityParsers â†’ ParsedLine/Circle/Arc/Polyline/Hatch/Text/...
3. dxfToGeometry() â†’ BufferGeometry (ë ˆì´ì–´ë³„)
4. CadMeshViewer â†’ WireframeMesh/HatchMesh/TextMesh/... â†’ Three.js ë Œë”ë§
```

---

## 3. Implementation Checklist (êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸)

### 3.1 Phase 2.1.1: MVP (LINE ì—”í‹°í‹°)

- [âœ…] dxf-parser íŒ¨í‚¤ì§€ ì„¤ì¹˜
- [âœ…] CadViewer í´ë” êµ¬ì¡° ìƒì„±
- [âœ…] ë¼ìš°íŠ¸ ë° ë©”ë‰´ ì•„ì´í…œ ì¶”ê°€ (`/cad-viewer`)
- [âœ…] types/ ë””ë ‰í† ë¦¬ ë° constants.ts ì‘ì„±
- [âœ…] fileValidator.ts (íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬) - src/utils/ë¡œ ì´ë™ë¨
- [âœ…] dxfToGeometry.ts (DXFâ†’Three.js ë³€í™˜) ì‘ì„±
- [âœ…] useDXFParser.ts í›… ì‘ì„±
- [âœ…] FilePanel ì»´í¬ë„ŒíŠ¸ ì‘ì„± (FileUploadBox, SampleList, UrlInput)
- [âœ…] CadMesh.tsx ì»´í¬ë„ŒíŠ¸ ì‘ì„±
- [âœ…] CadScene.tsx ì»´í¬ë„ŒíŠ¸ ì‘ì„±
- [âœ…] dxf-parser.d.ts íƒ€ì… ì •ì˜ ì¶”ê°€
- [âœ…] í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ DXF íŒŒì¼ ìƒì„±

### 3.2 Phase 2.1.2: ì—”í‹°í‹° í™•ì¥

- [âœ…] ParsedCircle, ParsedArc, ParsedPolyline íƒ€ì… ì¶”ê°€
- [âœ…] CIRCLE íŒŒì‹± ë° ë Œë”ë§ (THREE.EllipseCurve)
- [âœ…] ARC íŒŒì‹± ë° ë Œë”ë§ (degreeâ†’radian ë³€í™˜)
- [âœ…] POLYLINE/LWPOLYLINE íŒŒì‹± ë° ë Œë”ë§ (closed ì²˜ë¦¬)
- [âœ…] cadDataToGeometry í†µí•© í•¨ìˆ˜

### 3.3 Phase 2.1.3: HATCH (2D) ì—”í‹°í‹° âœ…

- [âœ…] ParsedHatch íƒ€ì… ì •ì˜ (`types.ts:79-94`)
- [âœ…] HATCH ì—”í‹°í‹° íŒŒì‹± ë¡œì§ (`useDXFParser.ts:146-220`)
- [âœ…] HATCH boundary â†’ Three.js Shape ë³€í™˜ (`dxfToGeometry.ts:289`)
- [âœ…] Solid Fill ë Œë”ë§ (MeshBasicMaterial) (`CadMesh.tsx:275-282`)
- [âœ…] ë Œë”ë§ ëª¨ë“œ í† ê¸€ UI (Wireframe â†” Solid â†” Pattern) (`CadScene.tsx:257-273`)
- [âœ…] Pattern Fill ë Œë”ë§ (`dxfToGeometry.ts:383`)
- [âœ…] ë ˆì´ì–´ ì‹œìŠ¤í…œê³¼ í†µí•© (`CadMesh.tsx:62-67, 310-315`)

### 3.4 Phase 2.1.4: ì¶”ê°€ ì—”í‹°í‹° ì§€ì› âœ…

> **êµ¬í˜„ ìˆœì„œ**: TEXT â†’ MTEXT â†’ ELLIPSE â†’ SPLINE â†’ DIMENSION (ë³µì¡ë„ ì ì§„ì  ì¦ê°€)
> **êµ¬í˜„ ë°©ì‹**: drei Text ì»´í¬ë„ŒíŠ¸ (troika-three-text ê¸°ë°˜) ì‚¬ìš©

#### 3.4.1 TEXT ì—”í‹°í‹° (ìš°ì„ ìˆœìœ„ 1) âœ…

- [âœ…] ParsedText íƒ€ì… ì •ì˜ ì™„ì„± (`types/dxfEntity/parsed.ts`)
- [âœ…] TEXT íŒŒì‹± ë¡œì§ (`services/entityParsers.ts`)
- [âœ…] drei Text ì»´í¬ë„ŒíŠ¸ë¡œ 3D ë Œë”ë§ (`components/CadMesh.tsx`)
- [âœ…] í°íŠ¸ ë¡œë”© ë° ìºì‹±: drei Text ìì²´ ì²˜ë¦¬ (WebGL ìµœì í™”)
- [âœ…] TEXT íŒŒì‹± í…ŒìŠ¤íŠ¸ (`services/__tests__/entityParsers.test.ts`)

#### 3.4.2 MTEXT ì—”í‹°í‹° (ìš°ì„ ìˆœìœ„ 2) âœ…

- [âœ…] ParsedMText íƒ€ì… ì •ì˜ ì™„ì„± (`types/dxfEntity/parsed.ts`)
- [âœ…] MTEXT ì„œì‹ ì½”ë“œ íŒŒì‹± (`parseMTextFormatting()`)
    - `%%c`â†’Ã˜, `%%d`â†’Â°, `%%p`â†’Â±, `\P`â†’ì¤„ë°”ê¿ˆ, `\S`â†’ìŠ¤íƒë¶„ìˆ˜
- [âœ…] 9ê°œ attachment point ì§€ì› (`getTextAnchors()`)
- [âœ…] ë©€í‹°ë¼ì¸ í…ìŠ¤íŠ¸ ë Œë”ë§ (maxWidth ë˜í•‘)
- [âœ…] MTEXT íŒŒì‹± í…ŒìŠ¤íŠ¸ (`services/__tests__/entityParsers.test.ts`)

#### 3.4.3 ELLIPSE ì—”í‹°í‹° (ìš°ì„ ìˆœìœ„ 3) âœ…

- [âœ…] ParsedEllipse íƒ€ì… ì •ì˜ ì™„ì„± (`types/dxfEntity/parsed.ts`)
- [âœ…] ELLIPSE íŒŒì‹± ë¡œì§ (`services/entityParsers.ts`)
- [âœ…] ellipsesToGeometry() - THREE.EllipseCurve í™•ì¥ (`utils/dxfToGeometry.ts`)
- [âœ…] ë¶€ë¶„ íƒ€ì›í˜¸ ì²˜ë¦¬ (startParam/endParam)
- [âœ…] ì¥ì¶•/ë‹¨ì¶• íšŒì „ ë³€í™˜ ë¡œì§
- [âœ…] ELLIPSE í…ŒìŠ¤íŠ¸ í†µê³¼

#### 3.4.4 SPLINE ì—”í‹°í‹° (ìš°ì„ ìˆœìœ„ 4) âœ…

- [âœ…] ParsedSpline íƒ€ì… ì •ì˜ ì™„ì„± (`types/dxfEntity/parsed.ts`)
- [âœ…] SPLINE íŒŒì‹± ë¡œì§ (`services/entityParsers.ts`)
- [âœ…] splinesToGeometry() - CatmullRomCurve3 (`utils/dxfToGeometry.ts`)
- [âœ…] LOD ê¸°ë°˜ ì„¸ê·¸ë¨¼íŠ¸ ìµœì í™” (controlPoints Ã— 10)
- [âœ…] ë‹«íŒ ìŠ¤í”Œë¼ì¸ (closed) ì²˜ë¦¬
- [âœ…] SPLINE í…ŒìŠ¤íŠ¸ í†µê³¼

#### 3.4.5 DIMENSION ì—”í‹°í‹° (ìš°ì„ ìˆœìœ„ 5) âœ…

- [âœ…] ParsedDimension íƒ€ì… ì •ì˜ ì™„ì„± - 7ê°€ì§€ ìœ í˜• (`types/dxfEntity/parsed.ts`)
    - linear, aligned, angular, diameter, radius, angular3, ordinate
- [âœ…] DIMENSION íŒŒì‹± ë¡œì§ (`services/entityParsers.ts`)
- [âœ…] dimensionToGeometry() - ì„  + í…ìŠ¤íŠ¸ ì¡°í•© (`CadMesh.tsx:DimensionRenderData`)
- [âœ…] ì¹˜ìˆ˜ í…ìŠ¤íŠ¸ ìë™ ê³„ì‚° vs ì˜¤ë²„ë¼ì´ë“œ ì²˜ë¦¬
- [âœ…] DIMENSION í…ŒìŠ¤íŠ¸ í†µê³¼

#### 3.4.6 í†µí•© ë° ì™„ë£Œ âœ…

- [âœ…] CadMesh.tsxì— 5ê°œ ì‹ ê·œ ì—”í‹°í‹° ë Œë”ë§ ì¶”ê°€
- [âœ…] WebWorkerì— ì¶”ê°€ ì—”í‹°í‹° íŒŒì‹± ë™ê¸°í™” (`dxfParser.worker.ts`)
- [âœ…] ë ˆì´ì–´ ì‹œìŠ¤í…œ í†µí•© ê²€ì¦ (ìƒ‰ìƒ/ê°€ì‹œì„±)
- [âœ…] ParsedCADData íƒ€ì…ì— ì‹ ê·œ ì—”í‹°í‹° ë°°ì—´ ì¶”ê°€
- [âœ…] cadDataToGeometry() í†µí•© í•¨ìˆ˜ í™•ì¥ (ELLIPSE, SPLINE)
- [âœ…] ì „ì²´ í…ŒìŠ¤íŠ¸ í†µê³¼ (949 tests passed)

### 3.5 Phase 2.1.5: ë ˆì´ì–´ ê¸°ëŠ¥ âœ…

- [âœ…] LayerInfo íƒ€ì… ì •ì˜
- [âœ…] ë ˆì´ì–´ íŒŒì‹± ë¡œì§ ì¶”ê°€
- [âœ…] LayerPanel UI ì»´í¬ë„ŒíŠ¸
- [âœ…] ë ˆì´ì–´ë³„ ë Œë”ë§ ì ìš©
- [âœ…] DXF ìƒ‰ìƒ ë§¤í•‘ (ACI 1-9)

### 3.6 Phase 2.1.6: HATCH 3D Extrusion â³

- [ ] hatch3DExtrude.ts ìœ í‹¸ë¦¬í‹° ìƒì„± (utils/)
- [ ] ExtrudeGeometry ì˜µì…˜ ì •ì˜ (depth, bevelEnabled ë“±)
- [ ] 2D HATCH boundary â†’ THREE.Shape ë³€í™˜ ë¡œì§ í™•ì¥
- [ ] THREE.ExtrudeGeometry(shape, { depth }) ì ìš©
- [ ] Depth ì¡°ì ˆ UI ì»´í¬ë„ŒíŠ¸ (ìŠ¬ë¼ì´ë” ë˜ëŠ” input)
- [ ] 3D HATCH ë Œë”ë§ ë¡œì§ (CadMesh.tsx í™•ì¥)
- [ ] ë ˆì´ì–´ ì‹œìŠ¤í…œê³¼ 3D HATCH í†µí•©

### 3.7 Phase 2.1.7: ShadingMode ì ìš© â³

- [ ] useCadMaterial.ts í›… ìƒì„± (hooks/)
- [ ] useTeapotMaterial.ts íŒ¨í„´ ì°¸ì¡°í•˜ì—¬ êµ¬í˜„
- [ ] ShadingMode íƒ€ì… ì •ì˜ (wireframe/flat/smooth/glossy)
- [ ] MeshBasicMaterial (wireframe)
- [ ] MeshPhongMaterial (flat - flatShading: true)
- [ ] MeshLambertMaterial (smooth)
- [ ] MeshPhongMaterial (glossy - shininess: 150)
- [ ] CadMeshì— shadingMode prop ì¶”ê°€
- [ ] ShadingSelect UI ì»´í¬ë„ŒíŠ¸ ì—°ë™
- [ ] 3D ë©”ì‰¬ì—ë§Œ ShadingMode ì ìš© (2D ì„ /ë©´ì€ ê¸°ì¡´ ìœ ì§€)

### 3.8 Phase 2.1.8: ì„±ëŠ¥ ìµœì í™” ğŸ”„ (3D í™•ì¥)

- [âœ…] 2D Geometry ë¨¸ì§• (mergeBufferGeometries + ë©”ëª¨ë¦¬ ì •ë¦¬)
- [âœ…] WebWorker íŒŒì‹± (ëŒ€ìš©ëŸ‰ íŒŒì¼ > 2MB)
- [âœ…] 2D LOD (Level of Detail) - ì—”í‹°í‹° ìˆ˜ ê¸°ë°˜ ìë™ ì„¸ê·¸ë¨¼íŠ¸ ì¡°ì ˆ
- [ ] 3D ExtrudeGeometry ë¨¸ì§• ìµœì í™”
- [ ] 3D LOD ì ìš© (ExtrudeGeometry ì„¸ê·¸ë¨¼íŠ¸ ì¡°ì ˆ)
- [ ] 3D ë©”ì‰¬ ë©”ëª¨ë¦¬ ê´€ë¦¬

### 3.9 Phase 2.1.9: Unit í…ŒìŠ¤íŠ¸ ğŸ”„ (3D í™•ì¥)

- [âœ…] DXF íŒŒì„œ ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸ (useDXFParser.test.ts)
- [âœ…] ì§€ì˜¤ë©”íŠ¸ë¦¬ ë³€í™˜ ë¡œì§ í…ŒìŠ¤íŠ¸ (dxfToGeometry.test.ts)
- [âœ…] íŒŒì¼ ê²€ì¦ ë¡œì§ í…ŒìŠ¤íŠ¸ (src/utils/fileValidator.test.ts)
- [âœ…] URL ê²€ì¦ ë¡œì§ í…ŒìŠ¤íŠ¸ (src/utils/urlValidator.test.ts)
- [âœ…] DXF ë¡œë” í›… í…ŒìŠ¤íŠ¸ (useDxfLoader.test.ts)
- [âœ…] ì—”í‹°í‹° íŒŒì„œ í…ŒìŠ¤íŠ¸ (entityParsers.test.ts)
- [âœ…] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 62% ë‹¬ì„±
- [âœ…] HATCH 2D íŒŒì‹± í…ŒìŠ¤íŠ¸ ì¶”ê°€
- [âœ…] ë Œë”ë§ ëª¨ë“œ í† ê¸€ í…ŒìŠ¤íŠ¸ ì¶”ê°€
- [ ] HATCH 3D Extrusion í…ŒìŠ¤íŠ¸ (hatch3DExtrude.test.ts)
- [ ] ShadingMode material í…ŒìŠ¤íŠ¸ (useCadMaterial.test.ts)
- [ ] 3D ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

## 4. Key Implementation Details (í•µì‹¬ êµ¬í˜„ ìƒì„¸)

### 4.1 í•µì‹¬ ì½”ë“œ íŒ¨í„´

#### íƒ€ì… ì •ì˜

```typescript
// types.ts
export interface Point3D {
    x: number;
    y: number;
    z: number;
}

export interface ParsedLine {
    start: Point3D;
    end: Point3D;
    layer?: string;
}

export interface ParsedCircle {
    center: Point3D;
    radius: number;
    layer?: string;
}

export interface ParsedArc {
    center: Point3D;
    radius: number;
    startAngle: number; // degree
    endAngle: number; // degree
    layer?: string;
}

export interface ParsedPolyline {
    vertices: Point3D[];
    closed: boolean;
    layer?: string;
}

// ğŸ“‹ Phase 2.1.3 - HATCH ì—”í‹°í‹° (ê³„íšë¨)
export interface ParsedHatch {
    boundaries: Point3D[][]; // ê²½ê³„ í´ë¦¬ê³¤ ë°°ì—´ (ë‹¤ì¤‘ ê²½ê³„ ì§€ì›)
    patternName: string; // 'SOLID', 'ANSI31', etc.
    patternScale?: number; // íŒ¨í„´ ìŠ¤ì¼€ì¼
    patternAngle?: number; // íŒ¨í„´ ê°ë„ (degree)
    color?: number; // ACI ìƒ‰ìƒ ì¸ë±ìŠ¤
    layer?: string;
}

export type RenderMode = 'wireframe' | 'solid' | 'pattern';

export interface LayerInfo {
    name: string;
    color: string;
    visible: boolean;
    entityCount: number;
}

export interface ParsedCADData {
    lines: ParsedLine[];
    circles: ParsedCircle[];
    arcs: ParsedArc[];
    polylines: ParsedPolyline[];
    hatches: ParsedHatch[]; // Phase 2.1.3
    // Phase 2.1.4 ì¶”ê°€ ì—”í‹°í‹°
    texts: ParsedText[];
    mtexts: ParsedMText[];
    dimensions: ParsedDimension[];
    splines: ParsedSpline[];
    ellipses: ParsedEllipse[];
    layers: LayerInfo[];
    bounds: BoundingBox;
    metadata: CADMetadata;
    renderMode?: RenderMode;
}

// ğŸ“‹ Phase 2.1.4 - ì¶”ê°€ ì—”í‹°í‹° íƒ€ì… ì •ì˜ (ê³„íšë¨)
export interface ParsedText {
    content: string; // í…ìŠ¤íŠ¸ ë‚´ìš©
    position: Point3D; // ì‚½ì…ì 
    height: number; // í…ìŠ¤íŠ¸ ë†’ì´
    rotation: number; // íšŒì „ ê°ë„ (degree)
    alignment?: 'left' | 'center' | 'right';
    layer?: string;
}

export interface ParsedMText {
    content: string; // í…ìŠ¤íŠ¸ ë‚´ìš© (ì„œì‹ ì½”ë“œ í¬í•¨ ê°€ëŠ¥)
    position: Point3D; // ì‚½ì…ì 
    height: number; // í…ìŠ¤íŠ¸ ë†’ì´
    width: number; // í…ìŠ¤íŠ¸ ë°•ìŠ¤ ë„ˆë¹„
    rotation: number; // íšŒì „ ê°ë„ (degree)
    layer?: string;
}

export interface ParsedDimension {
    dimensionType: 'linear' | 'aligned' | 'angular' | 'radial' | 'diameter';
    defPoint1: Point3D; // ì¹˜ìˆ˜ì„  ì‹œì‘ì 
    defPoint2: Point3D; // ì¹˜ìˆ˜ì„  ëì 
    textPosition: Point3D; // ì¹˜ìˆ˜ í…ìŠ¤íŠ¸ ìœ„ì¹˜
    text?: string; // ì¹˜ìˆ˜ í…ìŠ¤íŠ¸ (ìë™ ê³„ì‚° ë˜ëŠ” ì˜¤ë²„ë¼ì´ë“œ)
    layer?: string;
}

export interface ParsedSpline {
    controlPoints: Point3D[]; // ì œì–´ì  ë°°ì—´
    degree: number; // ì°¨ìˆ˜ (ë³´í†µ 3 = cubic)
    closed: boolean; // ë‹«í˜ ì—¬ë¶€
    layer?: string;
}

export interface ParsedEllipse {
    center: Point3D; // ì¤‘ì‹¬ì 
    majorAxisEnd: Point3D; // ì¥ì¶• ëì  (ì¤‘ì‹¬ ê¸°ì¤€ ìƒëŒ€ ì¢Œí‘œ)
    minorAxisRatio: number; // ë‹¨ì¶•/ì¥ì¶• ë¹„ìœ¨
    startParam: number; // ì‹œì‘ íŒŒë¼ë¯¸í„° (0 = ì „ì²´ íƒ€ì›)
    endParam: number; // ë íŒŒë¼ë¯¸í„° (2Ï€ = ì „ì²´ íƒ€ì›)
    layer?: string;
}
```

#### ìƒìˆ˜ ì •ì˜

```typescript
// constants.ts
export const FILE_LIMITS = {
    MAX_SIZE_BYTES: 20 * 1024 * 1024, // 20MB
    WARNING_SIZE_BYTES: 5 * 1024 * 1024, // 5MB ê²½ê³ 
    WORKER_THRESHOLD_BYTES: 2 * 1024 * 1024, // 2MB â†’ WebWorker ì‚¬ìš©
    ACCEPTED_EXTENSIONS: ['.dxf'],
} as const;

export const LOD_CONFIG = {
    HIGH_QUALITY_SEGMENTS: 64, // ì—”í‹°í‹° < 1000
    MEDIUM_QUALITY_SEGMENTS: 32, // ì—”í‹°í‹° 1000-5000
    LOW_QUALITY_SEGMENTS: 16, // ì—”í‹°í‹° > 5000
} as const;

export const DXF_COLOR_MAP: Record<number, string> = {
    1: '#ff0000', // Red
    2: '#ffff00', // Yellow
    3: '#00ff00', // Green
    4: '#00ffff', // Cyan
    5: '#0000ff', // Blue
    6: '#ff00ff', // Magenta
    7: '#ffffff', // White
    8: '#808080', // Gray
    9: '#c0c0c0', // Light Gray
};
```

#### DXF íŒŒì‹± í›… íŒ¨í„´

```typescript
// hooks/useDXFParser.ts
export function useDXFParser() {
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);

    const parse = useCallback(async (file: File): Promise<ParsedCADData> => {
        setIsLoading(true);
        setError(null);

        try {
            const text = await file.text();
            const parser = new DxfParser();
            const dxf = parser.parseSync(text);

            const lines = dxf.entities
                .filter((e) => e.type === 'LINE')
                .map((e) => ({
                    start: {
                        x: e.vertices[0].x,
                        y: e.vertices[0].y,
                        z: e.vertices[0].z ?? 0,
                    },
                    end: {
                        x: e.vertices[1].x,
                        y: e.vertices[1].y,
                        z: e.vertices[1].z ?? 0,
                    },
                    layer: e.layer,
                }));

            // ... circles, arcs, polylines íŒŒì‹±

            return {
                lines,
                circles,
                arcs,
                polylines,
                layers,
                bounds,
                metadata,
            };
        } catch (err) {
            const message = err instanceof Error ? err.message : 'Parse error';
            setError(message);
            throw err;
        } finally {
            setIsLoading(false);
        }
    }, []);

    return { parse, isLoading, error, clearError: () => setError(null) };
}
```

#### ì§€ì˜¤ë©”íŠ¸ë¦¬ ë³€í™˜ íŒ¨í„´

```typescript
// utils/dxfToGeometry.ts
export function cadDataToGeometry(
    data: ParsedCADData,
    visibleLayers: Set<string>,
    segments?: number
): THREE.BufferGeometry {
    const geometries: THREE.BufferGeometry[] = [];
    const seg = segments ?? getLODSegments(getTotalEntityCount(data));

    // Lines
    geometries.push(linesToGeometry(filterByLayer(data.lines, visibleLayers)));

    // Circles
    geometries.push(
        circlesToGeometry(filterByLayer(data.circles, visibleLayers), seg)
    );

    // Arcs
    geometries.push(
        arcsToGeometry(filterByLayer(data.arcs, visibleLayers), seg)
    );

    // Polylines
    geometries.push(
        polylinesToGeometry(filterByLayer(data.polylines, visibleLayers))
    );

    // Merge all geometries
    const merged = mergeBufferGeometries(
        geometries.filter((g) => g.attributes.position?.count > 0)
    );

    // Cleanup
    geometries.forEach((g) => g.dispose());

    return merged ?? new THREE.BufferGeometry();
}
```

#### CIRCLE â†’ Three.js

```typescript
export function circlesToGeometry(
    circles: ParsedCircle[],
    segments = 64
): THREE.BufferGeometry {
    const vertices: number[] = [];

    for (const circle of circles) {
        const curve = new THREE.EllipseCurve(
            circle.center.x,
            circle.center.y,
            circle.radius,
            circle.radius,
            0,
            Math.PI * 2,
            false,
            0
        );
        const points = curve.getPoints(segments);

        for (let i = 0; i < points.length - 1; i++) {
            vertices.push(points[i].x, points[i].y, circle.center.z);
            vertices.push(points[i + 1].x, points[i + 1].y, circle.center.z);
        }
    }

    const geometry = new THREE.BufferGeometry();
    geometry.setAttribute(
        'position',
        new THREE.Float32BufferAttribute(vertices, 3)
    );
    return geometry;
}
```

#### ARC â†’ Three.js (degree â†’ radian)

```typescript
export function arcsToGeometry(
    arcs: ParsedArc[],
    segments = 64
): THREE.BufferGeometry {
    const vertices: number[] = [];

    for (const arc of arcs) {
        const startRad = (arc.startAngle * Math.PI) / 180;
        let endRad = (arc.endAngle * Math.PI) / 180;
        if (endRad < startRad) endRad += Math.PI * 2;

        const curve = new THREE.EllipseCurve(
            arc.center.x,
            arc.center.y,
            arc.radius,
            arc.radius,
            startRad,
            endRad,
            false,
            0
        );
        // ... points to vertices
    }

    return geometry;
}
```

#### ELLIPSE â†’ Three.js (Phase 2.1.4)

```typescript
export function ellipsesToGeometry(
    ellipses: ParsedEllipse[],
    segments = 64
): THREE.BufferGeometry {
    const vertices: number[] = [];

    for (const ellipse of ellipses) {
        // ì¥ì¶• ê¸¸ì´ ë° ë‹¨ì¶• ê¸¸ì´ ê³„ì‚°
        const majorLength = Math.sqrt(
            ellipse.majorAxisEnd.x ** 2 + ellipse.majorAxisEnd.y ** 2
        );
        const minorLength = majorLength * ellipse.minorAxisRatio;

        // ì¥ì¶• íšŒì „ ê°ë„
        const rotation = Math.atan2(
            ellipse.majorAxisEnd.y,
            ellipse.majorAxisEnd.x
        );

        const curve = new THREE.EllipseCurve(
            ellipse.center.x,
            ellipse.center.y,
            majorLength, // xRadius (ì¥ì¶•)
            minorLength, // yRadius (ë‹¨ì¶•)
            ellipse.startParam, // ì‹œì‘ íŒŒë¼ë¯¸í„° (0 = ì „ì²´)
            ellipse.endParam, // ë íŒŒë¼ë¯¸í„° (2Ï€ = ì „ì²´)
            false, // clockwise
            rotation // íšŒì „ ê°ë„
        );

        const points = curve.getPoints(segments);
        for (let i = 0; i < points.length - 1; i++) {
            vertices.push(points[i].x, points[i].y, ellipse.center.z);
            vertices.push(points[i + 1].x, points[i + 1].y, ellipse.center.z);
        }
    }

    const geometry = new THREE.BufferGeometry();
    geometry.setAttribute(
        'position',
        new THREE.Float32BufferAttribute(vertices, 3)
    );
    return geometry;
}
```

#### SPLINE â†’ Three.js (Phase 2.1.4)

```typescript
export function splinesToGeometry(
    splines: ParsedSpline[],
    segments = 64
): THREE.BufferGeometry {
    const vertices: number[] = [];

    for (const spline of splines) {
        // ì œì–´ì ì„ Vector3ë¡œ ë³€í™˜
        const points = spline.controlPoints.map(
            (p) => new THREE.Vector3(p.x, p.y, p.z)
        );

        // CatmullRomCurve3 ì‚¬ìš© (B-ìŠ¤í”Œë¼ì¸ ê·¼ì‚¬)
        const curve = new THREE.CatmullRomCurve3(
            points,
            spline.closed, // ë‹«íŒ ê³¡ì„  ì—¬ë¶€
            'catmullrom', // ê³¡ì„  íƒ€ì…: 'catmullrom' | 'centripetal' | 'chordal'
            0.5 // tension (0 = ì§ì„ ì— ê°€ê¹Œì›€, 1 = ë¶€ë“œëŸ¬ì›€)
        );

        // LOD ê¸°ë°˜ ì„¸ê·¸ë¨¼íŠ¸ ì¡°ì ˆ
        const segmentCount = Math.max(
            segments,
            spline.controlPoints.length * 10
        );
        const curvePoints = curve.getPoints(segmentCount);

        for (let i = 0; i < curvePoints.length - 1; i++) {
            vertices.push(curvePoints[i].x, curvePoints[i].y, curvePoints[i].z);
            vertices.push(
                curvePoints[i + 1].x,
                curvePoints[i + 1].y,
                curvePoints[i + 1].z
            );
        }
    }

    const geometry = new THREE.BufferGeometry();
    geometry.setAttribute(
        'position',
        new THREE.Float32BufferAttribute(vertices, 3)
    );
    return geometry;
}
```

#### TEXT â†’ Three.js (Phase 2.1.4)

```typescript
import { Text } from 'troika-three-text';

export function textsToGeometry(
    texts: ParsedText[],
    font?: string
): THREE.Group {
    const group = new THREE.Group();

    for (const text of texts) {
        // troika-three-text ì‚¬ìš© (ê¶Œì¥: ì„±ëŠ¥ ìš°ìˆ˜, ë™ì  í…ìŠ¤íŠ¸ ì§€ì›)
        const textMesh = new Text();
        textMesh.text = text.content;
        textMesh.fontSize = text.height;
        textMesh.position.set(
            text.position.x,
            text.position.y,
            text.position.z
        );
        textMesh.rotation.z = (text.rotation * Math.PI) / 180;
        textMesh.color = 0xffffff;
        textMesh.anchorX = text.alignment || 'left';
        textMesh.anchorY = 'bottom';

        // í°íŠ¸ ì„¤ì • (fallback ì²´ì¸)
        if (font) {
            textMesh.font = font;
        }

        textMesh.sync(); // ë¹„ë™ê¸° ë Œë”ë§ íŠ¸ë¦¬ê±°
        group.add(textMesh);
    }

    return group;
}

// ëŒ€ì•ˆ: THREE.TextGeometry (í°íŠ¸ ì‚¬ì „ ë¡œë“œ í•„ìš”)
export function textsToGeometryLegacy(
    texts: ParsedText[],
    font: THREE.Font
): THREE.BufferGeometry {
    const geometries: THREE.BufferGeometry[] = [];

    for (const text of texts) {
        const textGeom = new THREE.TextGeometry(text.content, {
            font: font,
            size: text.height,
            height: 0.1, // ë‘ê»˜ (3D)
            curveSegments: 12,
        });

        textGeom.translate(text.position.x, text.position.y, text.position.z);
        textGeom.rotateZ((text.rotation * Math.PI) / 180);
        geometries.push(textGeom);
    }

    return mergeBufferGeometries(geometries) ?? new THREE.BufferGeometry();
}
```

#### MTEXT â†’ Three.js (Phase 2.1.4)

```typescript
export function mtextsToGeometry(
    mtexts: ParsedMText[],
    font?: string
): THREE.Group {
    const group = new THREE.Group();

    for (const mtext of mtexts) {
        // ì„œì‹ ì½”ë“œ íŒŒì‹±
        const cleanText = parseMTextFormatting(mtext.content);

        const textMesh = new Text();
        textMesh.text = cleanText;
        textMesh.fontSize = mtext.height;
        textMesh.maxWidth = mtext.width; // í…ìŠ¤íŠ¸ ë°•ìŠ¤ ë„ˆë¹„
        textMesh.position.set(
            mtext.position.x,
            mtext.position.y,
            mtext.position.z
        );
        textMesh.rotation.z = (mtext.rotation * Math.PI) / 180;
        textMesh.color = 0xffffff;
        textMesh.textAlign = 'left';
        textMesh.lineHeight = 1.2;

        // Attachment point ì²˜ë¦¬ (9ê°€ì§€)
        const [anchorX, anchorY] = getAnchorFromAttachment(
            mtext.attachmentPoint
        );
        textMesh.anchorX = anchorX;
        textMesh.anchorY = anchorY;

        textMesh.sync();
        group.add(textMesh);
    }

    return group;
}

// MTEXT ì„œì‹ ì½”ë“œ íŒŒì‹±
function parseMTextFormatting(content: string): string {
    return content
        .replace(/%%c/gi, 'Ã˜') // ì§€ë¦„ ê¸°í˜¸
        .replace(/%%d/gi, 'Â°') // ê°ë„ ê¸°í˜¸
        .replace(/%%p/gi, 'Â±') // í”ŒëŸ¬ìŠ¤ë§ˆì´ë„ˆìŠ¤
        .replace(/\\P/g, '\n') // ì¤„ë°”ê¿ˆ
        .replace(/\\S([^;]+);/g, '$1') // ìŠ¤íƒ ë¶„ìˆ˜ (ê°„ì†Œí™”)
        .replace(/\{[^}]*\}/g, '') // ì„œì‹ ë¸”ë¡ ì œê±°
        .replace(/\\[A-Za-z][^;]*;/g, ''); // ê¸°íƒ€ ì„œì‹ ì½”ë“œ ì œê±°
}

// Attachment point â†’ anchor ë³€í™˜
function getAnchorFromAttachment(point?: number): [string, string] {
    const map: Record<number, [string, string]> = {
        1: ['left', 'top'], // TL
        2: ['center', 'top'], // TC
        3: ['right', 'top'], // TR
        4: ['left', 'middle'], // ML
        5: ['center', 'middle'], // MC
        6: ['right', 'middle'], // MR
        7: ['left', 'bottom'], // BL
        8: ['center', 'bottom'], // BC
        9: ['right', 'bottom'], // BR
    };
    return map[point ?? 7] || ['left', 'bottom'];
}
```

#### DIMENSION â†’ Three.js (Phase 2.1.4)

```typescript
export function dimensionsToGeometry(
    dimensions: ParsedDimension[],
    font?: string
): THREE.Group {
    const group = new THREE.Group();

    for (const dim of dimensions) {
        const dimGroup = new THREE.Group();

        // 1. ì¹˜ìˆ˜ì„  (dimension line)
        const dimLine = createDimensionLine(dim);
        dimGroup.add(dimLine);

        // 2. ë³´ì¡°ì„  (extension lines)
        const extLines = createExtensionLines(dim);
        dimGroup.add(extLines);

        // 3. í™”ì‚´í‘œ (arrowheads)
        const arrows = createArrowheads(dim);
        dimGroup.add(arrows);

        // 4. ì¹˜ìˆ˜ í…ìŠ¤íŠ¸
        const dimText = createDimensionText(dim, font);
        dimGroup.add(dimText);

        group.add(dimGroup);
    }

    return group;
}

function createDimensionLine(dim: ParsedDimension): THREE.Line {
    const points = [
        new THREE.Vector3(dim.defPoint1.x, dim.defPoint1.y, dim.defPoint1.z),
        new THREE.Vector3(dim.defPoint2.x, dim.defPoint2.y, dim.defPoint2.z),
    ];
    const geometry = new THREE.BufferGeometry().setFromPoints(points);
    const material = new THREE.LineBasicMaterial({ color: 0xffffff });
    return new THREE.Line(geometry, material);
}

function createExtensionLines(dim: ParsedDimension): THREE.Group {
    const group = new THREE.Group();
    const gap = 0.5; // ì—”í‹°í‹°ì™€ ë³´ì¡°ì„  ì‚¬ì´ ê°„ê²©
    const extend = 1.0; // ì¹˜ìˆ˜ì„  ë„ˆë¨¸ ì—°ì¥

    // ë³´ì¡°ì„  1, 2 ìƒì„± (ì¹˜ìˆ˜ ìœ í˜•ì— ë”°ë¼ ë‹¤ë¦„)
    // ... ìƒëµ

    return group;
}

function createArrowheads(dim: ParsedDimension): THREE.Group {
    const group = new THREE.Group();
    const arrowSize = 2.5;

    // ConeGeometry ê¸°ë°˜ í™”ì‚´í‘œ
    const arrowGeom = new THREE.ConeGeometry(arrowSize * 0.3, arrowSize, 8);
    const arrowMat = new THREE.MeshBasicMaterial({ color: 0xffffff });

    // ì‹œì‘ì  í™”ì‚´í‘œ
    const arrow1 = new THREE.Mesh(arrowGeom, arrowMat);
    arrow1.position.set(dim.defPoint1.x, dim.defPoint1.y, dim.defPoint1.z);
    // ë°©í–¥ ì„¤ì •...
    group.add(arrow1);

    // ëì  í™”ì‚´í‘œ
    const arrow2 = arrow1.clone();
    arrow2.position.set(dim.defPoint2.x, dim.defPoint2.y, dim.defPoint2.z);
    arrow2.rotation.z += Math.PI;
    group.add(arrow2);

    return group;
}

function createDimensionText(dim: ParsedDimension, font?: string): Text {
    const textMesh = new Text();

    // í…ìŠ¤íŠ¸ ê²°ì •: ì˜¤ë²„ë¼ì´ë“œ ë˜ëŠ” ìë™ ê³„ì‚°
    if (dim.text && dim.text !== '') {
        textMesh.text = dim.text;
    } else {
        // ìë™ ê±°ë¦¬ ê³„ì‚°
        const distance = Math.sqrt(
            (dim.defPoint2.x - dim.defPoint1.x) ** 2 +
                (dim.defPoint2.y - dim.defPoint1.y) ** 2
        );
        textMesh.text = distance.toFixed(2);
    }

    textMesh.fontSize = 2.5;
    textMesh.position.set(
        dim.textPosition.x,
        dim.textPosition.y,
        dim.textPosition.z
    );
    textMesh.anchorX = 'center';
    textMesh.anchorY = 'middle';
    textMesh.color = 0xffffff;

    textMesh.sync();
    return textMesh;
}
```

#### Interface Contracts (í™•ì¥ íŒ¨í„´)

```typescript
// ì—”í‹°í‹° íŒŒì„œ ì¸í„°í˜ì´ìŠ¤
interface EntityParser<T extends ParsedEntity> {
    /** ì´ íŒŒì„œê°€ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸ */
    canParse(entity: DxfEntity): boolean;
    /** DXF ì—”í‹°í‹°ë¥¼ ParsedEntityë¡œ ë³€í™˜ */
    parse(entity: DxfEntity): T | null;
}

// ì§€ì˜¤ë©”íŠ¸ë¦¬ ë³€í™˜ê¸° ì¸í„°í˜ì´ìŠ¤
interface GeometryConverter<T extends ParsedEntity> {
    /** ParsedEntityë¥¼ Three.js ì§€ì˜¤ë©”íŠ¸ë¦¬ë¡œ ë³€í™˜ */
    convert(
        parsed: T[],
        options?: ConvertOptions
    ): THREE.BufferGeometry | THREE.Group;
}

// ë³€í™˜ ì˜µì…˜
interface ConvertOptions {
    segments?: number; // LOD ì„¸ê·¸ë¨¼íŠ¸ ìˆ˜
    font?: string; // í°íŠ¸ ê²½ë¡œ (í…ìŠ¤íŠ¸ìš©)
    arrowSize?: number; // í™”ì‚´í‘œ í¬ê¸° (ì¹˜ìˆ˜ìš©)
}

// íŒŒì„œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (í™•ì¥ ê°€ëŠ¥í•œ íŒ¨í„´)
class EntityParserRegistry {
    private parsers: Map<string, EntityParser<any>> = new Map();

    register<T extends ParsedEntity>(type: string, parser: EntityParser<T>) {
        this.parsers.set(type.toUpperCase(), parser);
    }

    parse(entity: DxfEntity): ParsedEntity | null {
        const parser = this.parsers.get(entity.type.toUpperCase());
        if (parser?.canParse(entity)) {
            return parser.parse(entity);
        }
        console.warn(`No parser for entity type: ${entity.type}`);
        return null;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
const registry = new EntityParserRegistry();
registry.register('LINE', new LineParser());
registry.register('TEXT', new TextParser());
registry.register('ELLIPSE', new EllipseParser());
```

#### Specification Examples (DXF â†’ ParsedEntity â†’ Geometry)

> **ëª©ì **: ê° ì—”í‹°í‹° íƒ€ì…ë³„ DXF ì…ë ¥ê³¼ ì˜ˆìƒ ì¶œë ¥ì„ ëª…ì‹œí•˜ì—¬ í…ŒìŠ¤íŠ¸ ê¸°ì¤€ ì œê³µ

##### TEXT Entity Example

**DXF Input:**

```
0
TEXT
8
Layer1
10
100.0
20
50.0
30
0.0
40
2.5
1
Hello World
50
45.0
```

**ParsedText Output:**

```typescript
{
  type: 'TEXT',
  position: { x: 100.0, y: 50.0, z: 0.0 },
  height: 2.5,
  value: 'Hello World',
  rotation: 45.0,
  layer: 'Layer1'
}
```

**Geometry Output:**

- troika-three-text Mesh ë˜ëŠ” THREE.TextGeometry ê¸°ë°˜
- Position: Vector3(100, 50, 0)
- 45Â° íšŒì „ ì ìš©

---

##### ELLIPSE Entity Example

**DXF Input:**

```
0
ELLIPSE
8
Layer1
10
0.0
20
0.0
30
0.0
11
100.0
21
0.0
31
0.0
40
0.5
41
0.0
42
6.283185
```

**ParsedEllipse Output:**

```typescript
{
  type: 'ELLIPSE',
  center: { x: 0.0, y: 0.0, z: 0.0 },
  majorAxisEnd: { x: 100.0, y: 0.0, z: 0.0 },  // ì¥ì¶• ë°©í–¥
  minorAxisRatio: 0.5,                          // ë‹¨ì¶• = 50
  startParam: 0.0,                              // ì „ì²´ íƒ€ì›
  endParam: 6.283185,                           // 2Ï€
  layer: 'Layer1'
}
```

**Geometry Output:**

- BufferGeometry with LineSegments
- 64 segments (LOD high)
- xRadius: 100, yRadius: 50
- rotation: 0 (ì¥ì¶•ì´ Xì¶•ê³¼ ì¼ì¹˜)

---

##### SPLINE Entity Example

**DXF Input:**

```
0
SPLINE
8
Layer1
71
3
72
4
10
0.0
20
0.0
30
0.0
10
10.0
20
20.0
30
0.0
10
30.0
20
10.0
30
0.0
10
40.0
20
0.0
30
0.0
```

**ParsedSpline Output:**

```typescript
{
  type: 'SPLINE',
  degree: 3,  // cubic
  controlPoints: [
    { x: 0, y: 0, z: 0 },
    { x: 10, y: 20, z: 0 },
    { x: 30, y: 10, z: 0 },
    { x: 40, y: 0, z: 0 }
  ],
  closed: false,
  layer: 'Layer1'
}
```

**Geometry Output:**

- CatmullRomCurve3 ê¸°ë°˜ ë¶€ë“œëŸ¬ìš´ ê³¡ì„ 
- 40+ segments (controlPoints.length Ã— 10)
- LineSegments í˜•íƒœ

---

##### Edge Cases

| Entity    | Edge Case            | Expected Behavior          |
| --------- | -------------------- | -------------------------- |
| TEXT      | ë¹ˆ ë¬¸ìì—´ (`1` ì—†ìŒ) | Skip parsing, console.warn |
| TEXT      | height=0             | ê¸°ë³¸ ë†’ì´ 1.0 ì ìš©         |
| ELLIPSE   | ratio=0              | Skip, invalid ellipse      |
| ELLIPSE   | startParam=endParam  | Skip, zero-length arc      |
| SPLINE    | controlPoints < 2    | Skip, insufficient points  |
| SPLINE    | degree > points-1    | degree = points - 1ë¡œ ì¡°ì • |
| DIMENSION | text=""              | ìë™ ê±°ë¦¬ ê³„ì‚°             |

### 4.2 ì„¤ì • ë° ìƒìˆ˜

| ìƒìˆ˜ëª…                    | ê°’   | ì„¤ëª…                           |
| ------------------------- | ---- | ------------------------------ |
| `MAX_SIZE_BYTES`          | 20MB | ìµœëŒ€ íŒŒì¼ í¬ê¸°                 |
| `WORKER_THRESHOLD_BYTES`  | 2MB  | WebWorker ì‚¬ìš© ê¸°ì¤€            |
| `HIGH_QUALITY_SEGMENTS`   | 64   | ì›/í˜¸ ì„¸ê·¸ë¨¼íŠ¸ (ì—”í‹°í‹° < 1000) |
| `MEDIUM_QUALITY_SEGMENTS` | 32   | ì›/í˜¸ ì„¸ê·¸ë¨¼íŠ¸ (1000-5000)     |
| `LOW_QUALITY_SEGMENTS`    | 16   | ì›/í˜¸ ì„¸ê·¸ë¨¼íŠ¸ (> 5000)        |

### 4.3 Error Handling & Resilience

> **ëª©ì **: ì•ˆì •ì ì¸ DXF íŒŒì‹± ë° ë Œë”ë§ì„ ìœ„í•œ ì˜¤ë¥˜ ì²˜ë¦¬ ì „ëµ

#### 4.3.1 Graceful Degradation

| ì‹œë‚˜ë¦¬ì˜¤                 | ë™ì‘                     | ë³µêµ¬ ì „ëµ                                 |
| ------------------------ | ------------------------ | ----------------------------------------- |
| **ì§€ì›ë˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°** | Skip with `console.warn` | ë‚˜ë¨¸ì§€ ì—”í‹°í‹° ì •ìƒ íŒŒì‹± ê³„ì†              |
| **íŒŒì‹± ì‹¤íŒ¨ ì—”í‹°í‹°**     | í•´ë‹¹ ì—”í‹°í‹°ë§Œ ì œì™¸       | ì˜¤ë¥˜ ì¹´ìš´íŠ¸ ê¸°ë¡, UIì— ê²½ê³  í‘œì‹œ          |
| **í°íŠ¸ ë¡œë“œ ì‹¤íŒ¨**       | Fallback í°íŠ¸ ì‚¬ìš©       | System font â†’ Basic geometry fallback     |
| **WebWorker í¬ë˜ì‹œ**     | ë©”ì¸ ìŠ¤ë ˆë“œ fallback     | ìµœëŒ€ 3íšŒ ì¬ì‹œë„ â†’ ì‘ì€ íŒŒì¼ë§Œ ë©”ì¸ ìŠ¤ë ˆë“œ |
| **ë©”ëª¨ë¦¬ ë¶€ì¡±**          | ë¶€ë¶„ ë Œë”ë§              | LOD ìë™ ë‹¤ìš´ê·¸ë ˆì´ë“œ                     |

#### 4.3.2 Error Recovery Patterns

```typescript
// ì—”í‹°í‹° íŒŒì‹± ì˜¤ë¥˜ ì²˜ë¦¬
function parseEntitySafe<T>(
    entity: DxfEntity,
    parser: (e: DxfEntity) => T
): T | null {
    try {
        return parser(entity);
    } catch (error) {
        console.warn(`Failed to parse ${entity.type}:`, error);
        incrementErrorCount(entity.type);
        return null;
    }
}

// WebWorker ì¬ì‹œë„ ë¡œì§
async function parseWithWorkerRetry(
    content: string,
    maxRetries = 3
): Promise<ParsedCADData> {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
            return await parseWithWorker(content);
        } catch (error) {
            if (attempt === maxRetries) {
                console.warn('Worker failed, falling back to main thread');
                return parseOnMainThread(content);
            }
            await delay(100 * attempt); // Exponential backoff
        }
    }
    throw new Error('Parsing failed');
}
```

#### 4.3.3 Font Fallback Strategy

```typescript
const FONT_FALLBACK_CHAIN = [
    { name: 'DXF_STANDARD', path: '/fonts/standard.json' },
    { name: 'SYSTEM_SANS', path: '/fonts/helvetiker.json' },
    { name: 'BASIC_GEOMETRY', path: null }, // ë§ˆì§€ë§‰ fallback: ì /ì„ ìœ¼ë¡œ í‘œì‹œ
];

async function loadFontWithFallback(): Promise<Font | null> {
    for (const font of FONT_FALLBACK_CHAIN) {
        if (!font.path) {
            console.warn('Using basic geometry fallback for text');
            return null;
        }
        try {
            return await loadFont(font.path);
        } catch {
            console.warn(`Font ${font.name} load failed, trying next`);
        }
    }
    return null;
}
```

#### 4.3.4 Memory Management

| íŒŒì¼ í¬ê¸°   | ì „ëµ        | ìƒì„¸                          |
| ----------- | ----------- | ----------------------------- |
| **< 2MB**   | ì¼ë°˜ íŒŒì‹±   | ë©”ì¸ ìŠ¤ë ˆë“œ, ì „ì²´ ë Œë”ë§      |
| **2-10MB**  | WebWorker   | ë°±ê·¸ë¼ìš´ë“œ íŒŒì‹±, ì²­í¬ ë Œë”ë§  |
| **10-20MB** | ìŠ¤íŠ¸ë¦¼ íŒŒì‹± | ì²­í¬ ë‹¨ìœ„ íŒŒì‹±, ì ì§„ì  ë Œë”ë§ |
| **> 20MB**  | ê±°ë¶€        | ì˜¤ë¥˜ ë©”ì‹œì§€, íŒŒì¼ ë¶„í•  ê¶Œì¥   |

```typescript
// Geometry cleanup on unmount
useEffect(() => {
    return () => {
        geometries.forEach((g) => g.dispose());
        materials.forEach((m) => m.dispose());
    };
}, [geometries, materials]);

// Memory warning
const MAX_ENTITY_WARNING = 50000;
if (totalEntities > MAX_ENTITY_WARNING) {
    console.warn(
        `High entity count (${totalEntities}). Performance may be impacted.`
    );
    showUserWarning('large-file');
}
```

#### 4.3.5 Error Reporting

```typescript
interface ParseErrorReport {
    fileSize: number;
    totalEntities: number;
    failedEntities: Record<string, number>; // { 'TEXT': 3, 'SPLINE': 1 }
    parseTimeMs: number;
    usedWorker: boolean;
    memoryUsage?: number;
}

// íŒŒì‹± ì™„ë£Œ í›„ ë¦¬í¬íŠ¸ ìƒì„±
function generateParseReport(result: ParseResult): ParseErrorReport {
    return {
        fileSize: result.fileSize,
        totalEntities: result.entityCount,
        failedEntities: result.errors,
        parseTimeMs: result.duration,
        usedWorker: result.workerUsed,
    };
}
```

---

## 5. Testing Strategy (í…ŒìŠ¤íŠ¸ ì „ëµ)

### 5.1 Unit Tests

**í…ŒìŠ¤íŠ¸ ëŒ€ìƒ:**

- [âœ…] `fileValidator.ts` (src/utils/) - íŒŒì¼ íƒ€ì…/í¬ê¸° ê²€ì¦
- [âœ…] `urlValidator.ts` (src/utils/) - URL ê²€ì¦ ë° SSRF ë°©ì§€
- [âœ…] `dxfToGeometry.ts` - ê° ì—”í‹°í‹° ë³€í™˜ í•¨ìˆ˜
- [âœ…] `useDXFParser.ts` - íŒŒì‹± ë¡œì§
- [âœ…] `useDxfLoader.ts` - íŒŒì¼/URL ë¡œë”© ë¡œì§
- [âœ…] `entityParsers.ts` (services/) - ì—”í‹°í‹° íŒŒì‹± ë¡œì§

**í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜:**

```
src/features/CadViewer/
â”œâ”€â”€ utils/__tests__/dxfToGeometry.test.ts
â”œâ”€â”€ hooks/__tests__/useDXFParser.test.ts
â”œâ”€â”€ hooks/__tests__/useDxfLoader.test.ts
â””â”€â”€ services/__tests__/entityParsers.test.ts

src/utils/__tests__/
â”œâ”€â”€ fileValidator.test.ts
â”œâ”€â”€ urlValidator.test.ts
â”œâ”€â”€ errorClassifier.test.ts
â””â”€â”€ errorFormatter.test.ts

tests/mocks/dxf-parser/
â”œâ”€â”€ fixtures.ts
â””â”€â”€ mock-config.ts
```

**í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ:**

```typescript
describe('linesToGeometry', () => {
    it('should convert ParsedLine[] to BufferGeometry', () => {
        const lines: ParsedLine[] = [
            { start: { x: 0, y: 0, z: 0 }, end: { x: 10, y: 0, z: 0 } },
        ];
        const geometry = linesToGeometry(lines);
        expect(geometry.attributes.position.count).toBe(2);
    });

    it('should handle empty array', () => {
        const geometry = linesToGeometry([]);
        expect(geometry.attributes.position.count).toBe(0);
    });
});
```

### 5.2 Integration Tests

- [ ] íŒŒì¼ ì—…ë¡œë“œ â†’ ë Œë”ë§ E2E í…ŒìŠ¤íŠ¸
- [ ] ë ˆì´ì–´ í† ê¸€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] WebWorker íŒŒì‹± í…ŒìŠ¤íŠ¸

### 5.3 ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

| ê²€ì¦ í•­ëª©                       | ë°©ë²•                 | ìƒíƒœ |
| ------------------------------- | -------------------- | ---- |
| DXF íŒŒì¼ ì—…ë¡œë“œ                 | ìˆ˜ë™ í™•ì¸            | âœ…   |
| LINE/CIRCLE/ARC/POLYLINE ë Œë”ë§ | ìˆ˜ë™ í™•ì¸            | âœ…   |
| ë ˆì´ì–´ í† ê¸€                     | ìˆ˜ë™ í™•ì¸            | âœ…   |
| OrbitControls ì¡°ì‘              | ìˆ˜ë™ í™•ì¸            | âœ…   |
| íŒŒì¼ í¬ê¸° ì œí•œ (20MB)           | ìˆ˜ë™ í™•ì¸            | âœ…   |
| WebWorker (> 2MB)               | ìˆ˜ë™ í™•ì¸            | âœ…   |
| íƒ€ì… ì²´í¬                       | `npm run type-check` | âœ…   |
| ë¦°íŠ¸                            | `npm run lint`       | âœ…   |
| ë‹¨ìœ„ í…ŒìŠ¤íŠ¸                     | `npm run test`       | âœ…   |

---

## 6. Routes & Navigation (ë¼ìš°íŠ¸ ë° ë„¤ë¹„ê²Œì´ì…˜)

| Path          | Component     | Description          |
| ------------- | ------------- | -------------------- |
| `/cad-viewer` | CADViewerPage | CAD ë·°ì–´ ë©”ì¸ í˜ì´ì§€ |

---

## 7. Dependencies & References (ì˜ì¡´ì„± ë° ì°¸ì¡°)

### 7.1 í•„ìˆ˜ íŒ¨í‚¤ì§€

| íŒ¨í‚¤ì§€               | ë²„ì „     | ìš©ë„                  |
| -------------------- | -------- | --------------------- |
| `dxf-parser`         | ^1.1.2   | DXF íŒŒì¼ íŒŒì‹± (ASCII) |
| `three`              | ^0.181.0 | 3D ë Œë”ë§             |
| `@react-three/fiber` | ^8.x     | React Three.js í†µí•©   |
| `@react-three/drei`  | ^9.x     | OrbitControls ë“±      |

### 7.2 ì°¸ì¡° ë¬¸ì„œ

| ë¬¸ì„œ                                                            | ì—­í•                |
| --------------------------------------------------------------- | ------------------ |
| [Phase 1.2 Teapot](../01-Foundation/1.2_THREEJS_DEMO_TEAPOT.md) | ì»´í¬ë„ŒíŠ¸ íŒ¨í„´ ì°¸ì¡° |
| [DEV_GUIDE.md](../../DEV_GUIDE.md)                              | ê°œë°œ ì»¨ë²¤ì…˜        |
| [ARCHITECTURE.md](../../ARCHITECTURE.md)                        | ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜    |

### 7.3 ê´€ë ¨ Phase

| Phase     | ê´€ê³„ | ì„¤ëª…                     |
| --------- | ---- | ------------------------ |
| Phase 1.2 | ì˜ì¡´ | Teapot íŒ¨í„´ ì™„ë£Œ í›„ ì‹œì‘ |
| Phase 2.2 | í›„ì† | PDF ë·°ì–´ (ë°±ì—”ë“œ í•„ìš”)   |
| Phase 3   | ì—°ê´€ | ë°±ì—”ë“œ API ì—°ë™          |

---

## 8. Usage Guide (ì‚¬ìš© ê°€ì´ë“œ)

### 8.1 ê°œë°œ ì„œë²„ ì‹¤í–‰

```bash
npm run dev
```

### 8.2 ë¸Œë¼ìš°ì € ì ‘ì†

```
http://localhost:3000/cad-viewer
```

### 8.3 ì‚¬ìš©ë²•

1. ì¢Œì¸¡ ìƒë‹¨ ì—…ë¡œë“œ ì˜ì—­ì— DXF íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
2. ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ
3. 3D ì™€ì´ì–´í”„ë ˆì„ ë Œë”ë§ í™•ì¸
4. ë§ˆìš°ìŠ¤ë¡œ íšŒì „/í™•ëŒ€/ì´ë™ ì¡°ì‘
5. ìš°ì¸¡ ë ˆì´ì–´ íŒ¨ë„ì—ì„œ ë ˆì´ì–´ë³„ í‘œì‹œ/ìˆ¨ê¹€

---

## 9. Post-Completion Checklist (ì™„ë£Œ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸)

ê°œë°œ ì™„ë£Œ ì‹œ Claudeê°€ ì•„ë˜ ë¬¸ì„œë“¤ì˜ ì—…ë°ì´íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì œì•ˆí•©ë‹ˆë‹¤.

### 9.1 ì—°ê´€ ë¬¸ì„œ ì—…ë°ì´íŠ¸ (Claude ìë™ ì œì•ˆ)

| ë¬¸ì„œ                             | ì—…ë°ì´íŠ¸ ë‚´ìš©                                     |
| -------------------------------- | ------------------------------------------------- |
| `docs/phases/PHASE_NAV_GUIDE.md` | Phase ë¬¸ì„œ ë§í¬, ìƒíƒœ, ì§„í–‰ë¥  ì—…ë°ì´íŠ¸            |
| `docs/ROADMAP.md`                | Phase ìƒíƒœ (ğŸ”„â†’âœ…), ì§„í–‰ë¥ , Milestones, ë³€ê²½ ì´ë ¥ |
| `docs/GLOSSARY.md`               | ìƒˆë¡œìš´ ìš©ì–´/ì•½ì–´ ì¶”ê°€                             |
| `docs/ARCHITECTURE.md`           | íŒ¨í‚¤ì§€ êµ¬ì¡°, ë ˆì´ì–´ë³„ ì—­í• , ê´€ë ¨ ë¬¸ì„œ ë§í¬        |
| `README.md`                      | í˜„ì¬ ìƒíƒœ, êµ¬í˜„ ì™„ë£Œ ê¸°ëŠ¥, ê°œë°œ ì˜ˆì • ëª©ë¡         |

### 9.2 ì—…ë°ì´íŠ¸ í”„ë¡œì„¸ìŠ¤

1. **êµ¬í˜„ ì™„ë£Œ** â†’ Claudeê°€ "ì—°ê´€ ë¬¸ì„œ ì—…ë°ì´íŠ¸í• ê¹Œìš”?" ì œì•ˆ
2. **ë³€ê²½ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°** â†’ ê° ë¬¸ì„œë³„ ìˆ˜ì •ë  ë‚´ìš© í‘œì‹œ
3. **ìŠ¹ì¸** â†’ ì‚¬ìš©ì í™•ì¸ í›„ ì¼ê´„ ì—…ë°ì´íŠ¸

---

## 10. Changelog (ë³€ê²½ ì´ë ¥)

| ë²„ì „  | ë‚ ì§œ       | ë³€ê²½ ë‚´ìš©                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ----- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 0.0.8 | 2025-12-30 | **ë¬¸ì„œ ë™ê¸°í™”**: Section 2.1 ë””ë ‰í† ë¦¬ êµ¬ì¡° ì—…ë°ì´íŠ¸ (ì‹¤ì œ êµ¬í˜„ ë°˜ì˜). CadMeshâ†’src/components/CadMesh/, dxfToGeometryâ†’src/utils/cad/, íƒ€ì…â†’src/types/cad/ ë¦¬íŒ©í† ë§ ë°˜ì˜. Section 2.2 ì»´í¬ë„ŒíŠ¸ ê³„ì¸µì— CadMeshViewer ë° í•˜ìœ„ ë©”ì‰¬ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€. Section 2.3 ë°ì´í„° íë¦„ ì—…ë°ì´íŠ¸.                                                                                                                                                                                                |
| 0.0.7 | 2025-12-29 | **Phase 2.1.4 ì™„ë£Œ**: TEXT/MTEXT/ELLIPSE/SPLINE/DIMENSION 5ê°œ ì—”í‹°í‹° êµ¬í˜„ ì™„ë£Œ (íŒŒì‹±, ë Œë”ë§, WebWorker í†µí•©). drei Text ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©. í…ŒìŠ¤íŠ¸ 949ê°œ í†µê³¼. ì§„í–‰ë¥  75%                                                                                                                                                                                                                                                                                                          |
| 0.0.6 | 2025-12-29 | ì½”ë“œ ë™ê¸°í™”: types/ êµ¬ì¡°í™”, workers/â†’services/, validatorsâ†’src/utils ì´ë™ / **Phase 2.1.4 ì°©ìˆ˜**: Section 3.4 ì²´í¬ë¦¬ìŠ¤íŠ¸ 30í•­ëª© í™•ì¥ + Acceptance Criteria ì¶”ê°€ / **Spec-Panel ê°œì„ **: Section 4.1 Specification Examples (DXFâ†’Geometry ì˜ˆì œ), Section 4.3 Error Handling & Resilience ì‹ ê·œ ìƒì„± / **Analyze ê°œì„ **: Section 4.1 TEXT/MTEXT/DIMENSION ì½”ë“œ íŒ¨í„´ + Interface Contracts ì¶”ê°€, Section 3.4.2 MTEXT DXF ê·¸ë£¹ ì½”ë“œ, Section 3.4.5 DIMENSION DXF ê·¸ë£¹ ì½”ë“œ ìƒì„¸ ì¶”ê°€ |
| 0.0.5 | 2025-12-22 | ë§ˆì¼ìŠ¤í†¤ ì¬ë°°ì¹˜: 2.1.6 HATCH 3D, 2.1.7 ShadingMode ì¶”ê°€, 2.1.8 ì„±ëŠ¥ìµœì í™”/2.1.9 Unití…ŒìŠ¤íŠ¸ 3D í™•ì¥ìœ¼ë¡œ ì´ë™, ROADMAP.md ë™ê¸°í™”, ì§„í–‰ë¥  60%                                                                                                                                                                                                                                                                                                                                     |
| 0.0.4 | 2025-12-17 | Phase 2.1.4 ì¶”ê°€ ì—”í‹°í‹° ê³„íš ì¶”ê°€ ë° ë²ˆí˜¸ ì¬ì •ë ¬, HATCH êµ¬í˜„ ì™„ë£Œ, Claude Commands ì„¹ì…˜ ì¶”ê°€, íƒ€ì… ì •ì˜ ì¶”ê°€                                                                                                                                                                                                                                                                                                                                                                   |
| 0.0.3 | 2025-12-04 | í…œí”Œë¦¿ v0.0.2 ê¸°ì¤€ ì„¹ì…˜ ìˆœì„œ ë³€ê²½ (Routesâ†”Dependencies)                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 0.0.2 | 2025-12-03 | Phase 2.1 ì™„ë£Œ: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ êµ¬í˜„ (58ê°œ í†µê³¼), í…œí”Œë¦¿ ê¸°ì¤€ ë©”íƒ€ë°ì´í„° ê°„ì†Œí™”, utils ì»¤ë²„ë¦¬ì§€ 98.29% ë‹¬ì„±                                                                                                                                                                                                                                                                                                                                                                        |
| 0.0.1 | 2025-12-02 | í…œí”Œë¦¿ ì ìš©, ë²„ì „ ê°€ì´ë“œë¼ì¸ ì ìš© (0.0.x), Section 10 ì¶”ê°€                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 0.0.0 | 2025-12-01 | ì´ˆê¸° ë¬¸ì„œ ì‘ì„±, 2.1.1~2.1.4 êµ¬í˜„ ì™„ë£Œ                                                                                                                                                                                                                                                                                                                                                                                                                                          |
